---
layout: post
title: "DsmMarket - 7"
subtitle: "YOLO 학습, 추천 시스템 개편안"
categories: project
tag: dsmmarket
comments: true
---

**YOLO 학습**

darkflow를 다운받고, 충분히 학습되었을거라 생각해서(loss 0.05) 모델 테스트를 해봤다. 결과는 매우 좋지 않았다.

![](https://imgur.com/cXjCwWu.png)

담배의 위치는 대충 잡아냈지만, 완벽한 위치는 잡아내지 못한다. 이마저도 모든 학습 데이터를 넣은 것이 아니라 담배 데이터만 넣은 것일 뿐더러, threshold도 '제대로 된 사진 한 장만 뽑아보자'라는 생각에서 이리저리 조절해 0.045로 맞춘 값이다. 설마 나만 이런 현상을 겪는 것이 아닐거라 생각해서 darkflow issue를 찾아봤다.

![](https://imgur.com/4mJIX4C.png)

그러니까.. loss가 수렴한 뒤에도 어느 정도 학습을 진행해야 결과를 얻을 수 있다고 한다. 믿고 학습해보자. 이게 안 되면 yolo말고 다른 모델을 사용해야 할지도 모른다.

---

충분한 학습을 진행했다고 생각하고, 다시 사진 테스트를 해 보았다. 그러나 이번에도 결과는 좋지 않았다. 혹시 몰라 tiny-yolo말고 그냥 yolo를 사용했는데, bounding box가 담배의 윤곽조차 찾지 못했다. 아마도 역시 학습의 부재일 수 있다고 생각했다.

---

그래서 google colab을 사용해 보았다. github에 내가 맞춰놓은 cfg파일과 학습 데이터를 올리고, colab notebook에서 클론한 뒤 사용했다. 엄청나게 빠르다! 저번에 8시간만에 겨우 도달한 learning rate를 3분만에 도달했다. 일단 계속해서 더 돌려 보고 확인해봐야겠다.

![](https://imgur.com/t4Fkqim.png)

무척 성공적인 결과다. threshold를 0.3으로 한 결과인데, 담배의 모양과 위치를 매우 비스무리하게 잡아내고 있다. 이쯤 하면 테스트는 끝났고, 담배 뿐만이 아닌 담배곽, 술 등의 물건을 학습시킬 차례이다.

---

colab을 사용해도 오래 걸리는 모델 학습을 기다리며 멍때리던 와중에, 추천 시스템을 굳이 api를 이용해서 만들어야 하나 싶은 생각이 들었다. 그 즉시 도서관에 가서 찾은 책이 바로 Machine learning at work.

![](https://imgur.com/LSjUKgf.png)

역시 O'REILLY. 항상 좋은 지식들을 담고 있는 책을 출판한다.

이 책에서 기존 시스템에 머신러닝을 통합하는 과정 3가지를 보여주었다. 

1. 배치 처리로 학습 + 예측 결과를 웹 어플리케이션에서 직접 산출(예측 실시간 처리)
2. 배치 처리로 학습 + 예측 결과를 API를 통해 사용(예측 실시간 처리)
3. 배치 처리로 학습 + 예측 결과를 DB에 저장하고 사용(예측을 배치 처리)

나는 1번을 유심깊게 봤다. 현재 추천 시스템은 api로 만들어졌는데, 이는 1번으로 하면 굳이 열 필요 없는 서버를  하나 더 열게 되는 것이다. 어차피 카테고리를 통해 추천하므로 모델의 용량이 크지도 않아 1번의 단점도 해결할 수 있다. 웹 개발자들과 함께 논의해 봐야겠다.

---

웹 어플리케이션에서 모델을 돌릴 방법으로 tensorflow.js가 있다고 한다. 

기능은

- 학습된 모델 불러오기
- 불러온 모델 학습시키기
- 모델 작성

다 된다는 뜻이다. 나는 javascript를 모르고 웹 개발자는 tensorflow를 모르니 좋은 공부가 될 것이다.

---

웹 결합 어플리케이션 방식은 폐기한다. 프로젝트 기간이 그리 넉넉하지 않은데 모르는 기술을 적용하기에는 시간이 없다. 대신 tensorrec을 찾아냈다. 내가 만들어낸 조잡한 모델보다 예측 결과를 훨씬 좋게 낼 수 있는 추천 라이브러리이다. 라이브러리를 사용하는 것만으로는 내 성장에 도움이 되지 않으니, 라이브러리 내부를 뜯어보며 공부해야겠다.