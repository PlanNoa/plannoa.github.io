---
layout: post
title: "DsmMarket - 6"
subtitle: "유해이미지 수집"
categories: project
tag: dsmmarket
comments: true
---

**유해 이미지 수집**

앞서 논문과 요약본들을 보며 object detection에 대한 지식들을 쌓았다. Api에 사용할 모델로 YOLO를 선택했다. YOLO는 Faster R-Cnn, SSD보다 정확성이 떨어지지만, 그만큼 속도가 빠르다. 유해 이미지 검출 Api에서 True가 반환되면 포스트 작성을 보류하게 한다. 모든 사람이 그렇겠지만 난 평소에 로그인이나 포스팅에서의 로딩 시간을 정말 싫어한다. 어플리케이션에서 5~6초 걸리고 글 작성이 보류되었다고 하면 정말 짜증날 것 같기 때문에 일반적으로 속도가 가장 바른 YOLO를 선택했다.

전에 유해 이미지를 정의할 때 세 가지 물품을 정했다. 담배, 술, 칼. 셋 다 학생이 가지고 있기에는 어색한 물건이다. 그런데 학습 데이터를 모으려고 하다 보니 몇 가지 고민할 점이 생겼다. 

1. 담배에 궐련을 포함할 것인가? 
2. 담배를 학습시켜도 과연 얇은 원통형 흰색 연필과 담배를 구분할 수 있을까? 
3. 술이하고 하면 소주, 맥주 등 다양한 것이 있는데 어느 술들을 학습시킬 것인가?
4. 맥주를 학습시킨다 하면 코코팜과 맥주캔을 구분할 수 있을까?

---

답을 찾았다. 

1. 서양식 시가는 제외한다. 무슨 학생이 중고나라에 엽궐련을 팔겠는가?
2. 힘들 것 같다. 하지만 일단 유해 물품이니 학습시키고 보자.
3. 맥주는 빼자. 소주만 학습시키자.

자. 이제 모을 이미지가 정해졌다.

1. 담배
   1. 담배곽
   2. 담배
   3. 담배꽁초
2. 술
   1. 소주
   2. 양주
3. 날붙이

---

데이터를 모으고 나서는 bounding box를 쳐줘야 한다. YOLO train data를 쉽게 만들기 위한 [yolo_mark](https://github.com/AlexeyAB/Yolo_mark)라는 프로그램이 있다. 이 프로그램을 다운받자. 다운받고 종속성 설정이라든가 할 게 많았는데, 이에 대해서는 다른 분들의 글을 참조했다.

일구칠's Study & Project repository: <https://giantpark197cm.tistory.com/167>

하루를 쓰담다_: <https://writenkeep.tistory.com/6>

Murra blog : <https://murra.tistory.com/99>

그러고 나서 yolo_mark-master/x64/release 폴더에 data 폴더의 항목들을 수정하고 yolo_mark.cmd를 실행하면  적절한 학습 데이터들을 만들 수 있다.

---

전에 설치한 yolo_mark를 이용해 담배와 술, 날붙이 데이터를 적당히 수집하고 전처리했다. 담배 100장, 술 100장, 날붙이 100장을 처리했다. 하면서 느낀 점이 있는데, 학생 주제에 담배나 술같은 이미지를 계속 보고 있으니까 스트레스가 장난 아니더라. 술이나 칼까지는 그래도 괜찮지만 담배부터는 정말 끔찍했다. 

![](https://imgur.com/9R24FJr.png)

진짜 이거 몇 시간 하면 정신이 피폐해지는 것 같다.

---

전처리를 하고 나서는 darknet을 다운받고 학습시키려고 했지만.. 종속성 설정같은 귀찮은 일을 다 하고 나서, 학습을 시작하기 전에야 생각해냈다. 내가 이걸 학습시켜봤자 api에 어떻게 연결하지? 그래서 darknet이 아닌 darkflow를 다운받았다.

darknet과 다르게 darkflow는 xml 데이터로 학습한다. 변환 코드를 짜야하나 했는데, 다른 분이 만들어 놓은 코드가 있었다. [링크](<https://murra.tistory.com/62?category=693207>)

xml로 데이터를 변환시키고, google colab을 이용해 학습시키는 중이다.